<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Franzy-Avro</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Franzy-avro</span> <span class="project-version">0.0.1</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="README.html"><div class="inner"><span>Franzy-Avro</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>franzy</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serialization</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>avro</span></div></div></li><li class="depth-4 branch"><a href="franzy.serialization.avro.deserializers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deserializers</span></div></a></li><li class="depth-4"><a href="franzy.serialization.avro.serializers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serializers</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#franzy-avro" name="franzy-avro"></a>Franzy-Avro</h1>
<p><a href="http://kafka.apache.org/documentation.html">Kafka</a> serializer/deserializer using <a href="https://avro.apache.org/">Avro</a>.</p>
<p>The emphasis of this serializer is on serializing EDN to Avro, though the serializer will support any provided schema format.</p>
<p>This serializer uses <a href="https://github.com/damballa/abracad">Abracad</a> and any bugs, quirks, and associated features/limitations are thus present. As Abracada is as of this writing seeing some churn and bug fixing, there may be a few quirks.</p>
<p>Please review <a href="https://github.com/damballa/abracad">Abracad</a> and see if these behaviors are acceptable to you first.</p>
<p>Great fit with <a href="https://github.com/ymilky/franzy">Franzy</a>, a Clojure Kafka client, though not required.</p>
<h2><a href="#why" name="why"></a>Why</h2>
<ul>
  <li>You want your Kafka storage format as Avro.</li>
  <li>You are sending data directly from Kafka to Hadoop (additional support by Abracad).</li>
  <li>You are using Avro as a consistent format in your architecture.</li>
  <li>You want to serialize things to/from Clojure, even from other JVM languages.</li>
  <li>You want painless serialization of JSON without losing type information or extra munging for most use-cases.</li>
  <li>You want the possibility of deserializing your data back into Clojure with relative ease.</li>
  <li>You are using a Kafka client such as <a href="https://github.com/ymilky/franzy">Franzy</a> and need a plugable, robust serializer.</li>
  <li>You want to serialize Clojure data types with little effort.</li>
  <li>You want to compose with a message pack serializer/deserializer.</li>
  <li>You want seamless serialization, no embedded serialization calls at call sites or <code>.getBytes</code> ugly things floating around.</li>
</ul>
<h2><a href="#docs" name="docs"></a>Docs</h2>
<ul>
  <li>Read the browsable <a href="http://ymilky.github.io/franzy-avro/">API</a> and the tests.</li>
  <li>See <a href="https://github.com/ymilky/franzy">Franzy Source</a> and docs for more information about serializers/deserializers.</li>
  <li>For more information about working with Clojure and Avro, see <a href="https://github.com/damballa/abracad">Abracad</a>.</li>
</ul>
<h2><a href="#installation" name="installation"></a>Installation</h2>
<p>Add the necessary dependency to your project:</p>
<pre><code class="clojure">[ymilky/franzy-avro "0.0.1"]
</code></pre>
<p><a href="https://clojars.org/ymilky/franzy-avro"><img src="https://img.shields.io/clojars/v/ymilky/franzy-avro.svg" alt="Clojars Project" /></a></p>
<h2><a href="#serializing" name="serializing"></a>Serializing</h2>
<p>First, require:</p>
<pre><code class="clojure">(ns my-ns
  (:require [franzy.serialization.avro.serializers :as serializers]))
</code></pre>
<p>Then use with a producer, such as the one with <a href="https://github.com/ymilky/franzy">Franzy</a>.</p>
<pre><code class="clojure">  (let [;;optionally specify via Kakfa Config key - value.serializer using fully qualified class name
        pc {:bootstrap.servers ["127.0.0.1"]}
        
        ;;ensure you define a schema, if not, a basic edn schema is the default
        ;;you must parse your schema so avro understands it
        schema (avro/parse-schema
                      {:name "example", :type "record",
                       :fields [{:name "left", :type "string"}
                                {:name "right", :type "long"}]
                       :abracad.reader "vector"})]
                               
        ;;Serializes producer record keys, ex: (keyword-serializer) from Franzy
        key-serializer (your-key-serializer-type)

        ;;avro serializer - serializes to binary
        value-serializer (serializers/avro-serializer schema)]
    (with-open [p (producer/make-producer pc key-serializer value-serializer)]
      ;;assault Kafka with data no one will ever see
      (send-async! "stolen-leftovers" 0 "lomein" "["3 days old, still stolen." 1234])))
</code></pre>
<p><strong>You may not mix and match serializers and deserializers.</strong></p>
<h2><a href="#deserializing" name="deserializing"></a>Deserializing</h2>
<p>First, require:</p>
<pre><code class="clojure">(ns my-ns
  (:require [franzy.serialization.avro.deserializers :as deserializers]))
</code></pre>
<p>Then use with a consumer, such as the one with <a href="https://github.com/ymilky/franzy">Franzy</a>.</p>
<pre><code class="clojure">  (let [;;optionally specify via Kafka Config key - value.deserializer using fully qualified class name
        cc {:bootstrap.servers ["127.0.0.1:9092"]
            :group.id          "hungry-hippos"}
        
        ;;ensure you use a consistent schema with the deserializer, i.e. same as before
        ;;basic edn schema is again the default if no schema is provided.
        schema (avro/parse-schema
                      {:name "example", :type "record",
                       :fields [{:name "left", :type "string"}
                                {:name "right", :type "long"}]
                       :abracad.reader "vector"})]
                       
        ;;Deserializes your record keys, ex: (keyword-deserializer) from Franzy
        key-deserializer (your-key-deserializer-type)
        
        ;;ensure you're using the same format when deserializing
        value-deserializer (deserializers/avro-deserializer schema)
        topic "stolen-leftovers"
        topic-partitions [{:topic topic :partition 0}]]
    (with-open [c (consumer/make-consumer cc key-deserializer value-deserializer)]
      (assign-partitions! c topic-partitions)
      (seek-to-beginning-offset! c topic-partitions)
      (poll! c)))
</code></pre>
<h2><a href="#todo" name="todo"></a>TODO</h2>
<ul>
  <li>If there is a demand for custom bindings for schemas, to support richer types, please let me know.</li>
</ul>
<p><strong>You may not mix and match serializers and deserializers.</strong></p>
<h2><a href="#license" name="license"></a>License</h2>
<p>Copyright Â© 2016 Yossi M. (ymilky).</p>
<p>Distributed under the Eclipse Public License either version 1.0 or (at your option) any later version.</p>
<p>Use at your own risk, I am not responsible or liable. Please give credit if you use pieces of this library or otherwise, it is much appreciated.</p></div></div></div></body></html>